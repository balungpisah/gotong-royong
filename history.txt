#V2
DEFINE FIELD correlation_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD occurred_at ON TABLE chat_delivery_event TYPE datetime;
DEFINE INDEX uniq_entity_request ON TABLE chat_delivery_event FIELDS entity_id, request_id UNIQUE;
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-1', occurred_at: time::now() };
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-2', occurred_at: time::now() };
SELECT * FROM chat_delivery_event WHERE entity_id='thread:alpha' AND request_id='req-123';
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-003', author_id: 'user:a', body: 'third', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-001', author_id: 'user:a', body: 'first', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-002', author_id: 'user:a', body: 'second', created_at: d'2026-02-15T03:30:00Z' };
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' ORDER BY created_at ASC, message_id ASC;
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' AND (created_at > d'2026-02-15T03:30:00Z' OR (created_at = d'2026-02-15T03:30:00Z' AND message_id > 'msg-001')) ORDER BY created_at ASC, message_id ASC;
LIVE SELECT * FROM chat_message WHERE thread_id = 'thread:live';
CREATE chat_message SET thread_id='thread:live', message_id='msg-live-1', author_id='user:live', body='live event', created_at=time::now();
DEFINE TABLE chat_delivery_event SCHEMAFULL;
DEFINE FIELD entity_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD request_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD correlation_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD occurred_at ON TABLE chat_delivery_event TYPE datetime;
DEFINE INDEX uniq_entity_request ON TABLE chat_delivery_event FIELDS entity_id, request_id UNIQUE;
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-1', occurred_at: time::now() };
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-2', occurred_at: time::now() };
SELECT * FROM chat_delivery_event WHERE entity_id='thread:alpha' AND request_id='req-123';
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-003', author_id: 'user:a', body: 'third', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-001', author_id: 'user:a', body: 'first', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-002', author_id: 'user:a', body: 'second', created_at: d'2026-02-15T03:30:00Z' };
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' ORDER BY created_at ASC, message_id ASC;
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' AND (created_at > d'2026-02-15T03:30:00Z' OR (created_at = d'2026-02-15T03:30:00Z' AND message_id > 'msg-001')) ORDER BY created_at ASC, message_id ASC;
LIVE SELECT * FROM chat_message WHERE thread_id = 'thread:live';
CREATE chat_message SET thread_id='thread:live', message_id='msg-live-1', author_id='user:live', body='live event', created_at=time::now();
LIVE SELECT DIFF FROM chat_message WHERE thread_id='t1';
DEFINE TABLE chat_message SCHEMALESS;
LIVE SELECT DIFF FROM chat_message WHERE thread_id='thread:diff';
DEFINE TABLE user SCHEMAFULL;
DEFINE FIELD email ON TABLE user TYPE string;
DEFINE FIELD pass ON TABLE user TYPE string;
DEFINE ACCESS account ON DATABASE TYPE RECORD
DEFINE TABLE user SCHEMAFULL;
DEFINE FIELD email ON TABLE user TYPE string;
DEFINE FIELD pass ON TABLE user TYPE string;
DEFINE ACCESS account ON DATABASE TYPE RECORD SIGNUP ( CREATE user CONTENT { email: $email, pass: $pass } ) SIGNIN ( SELECT * FROM user WHERE email = $email AND pass = $pass );
INFO FOR DB;
DEFINE TABLE user SCHEMAFULL;
DEFINE FIELD email ON TABLE user TYPE string;
DEFINE FIELD pass ON TABLE user TYPE string;
DEFINE ACCESS account ON DATABASE TYPE RECORD SIGNUP ( CREATE user SET email = $email, pass = $pass ) SIGNIN ( SELECT * FROM user WHERE email = $email AND pass = $pass );
DEFINE TABLE chat_private SCHEMAFULL PERMISSIONS FOR select WHERE owner = $auth.id, FOR create WHERE owner = $auth.id, FOR update WHERE owner = $auth.id, FOR delete WHERE owner = $auth.id;
DEFINE FIELD owner ON TABLE chat_private TYPE record<user>;
DEFINE FIELD body ON TABLE chat_private TYPE string;
INFO FOR DB;
LIVE SELECT * FROM chat_private;
DEFINE TABLE chat_delivery_event SCHEMAFULL;
DEFINE FIELD entity_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD request_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD correlation_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD occurred_at ON TABLE chat_delivery_event TYPE datetime;
DEFINE INDEX uniq_entity_request ON TABLE chat_delivery_event FIELDS entity_id, request_id UNIQUE;
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-1', occurred_at: time::now() };
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-2', occurred_at: time::now() };
SELECT * FROM chat_delivery_event WHERE entity_id='thread:alpha' AND request_id='req-123';
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-003', author_id: 'user:a', body: 'third', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-001', author_id: 'user:a', body: 'first', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-002', author_id: 'user:a', body: 'second', created_at: d'2026-02-15T03:30:00Z' };
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' ORDER BY created_at ASC, message_id ASC;
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' AND (created_at > d'2026-02-15T03:30:00Z' OR (created_at = d'2026-02-15T03:30:00Z' AND message_id > 'msg-001')) ORDER BY created_at ASC, message_id ASC;
LIVE SELECT * FROM chat_message WHERE thread_id = 'thread:live';
CREATE chat_message SET thread_id='thread:live', message_id='msg-live-1', author_id='user:live', body='live event', created_at=time::now();
LIVE SELECT DIFF FROM chat_message WHERE thread_id = 'thread:diff';
DEFINE TABLE user SCHEMAFULL;
DEFINE FIELD email ON TABLE user TYPE string;
DEFINE FIELD pass ON TABLE user TYPE string;
DEFINE ACCESS account ON DATABASE TYPE RECORD SIGNUP ( CREATE user SET email = $email, pass = $pass ) SIGNIN ( SELECT * FROM user WHERE email = $email AND pass = $pass );
DEFINE TABLE chat_private SCHEMAFULL PERMISSIONS FOR select WHERE owner = $auth.id, FOR create WHERE owner = $auth.id, FOR update WHERE owner = $auth.id, FOR delete WHERE owner = $auth.id;
DEFINE FIELD owner ON TABLE chat_private TYPE record<user>;
DEFINE FIELD body ON TABLE chat_private TYPE string;
LIVE SELECT * FROM chat_private;
DEFINE TABLE chat_delivery_event SCHEMAFULL;
DEFINE FIELD entity_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD request_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD correlation_id ON TABLE chat_delivery_event TYPE string;
DEFINE FIELD occurred_at ON TABLE chat_delivery_event TYPE datetime;
DEFINE INDEX uniq_entity_request ON TABLE chat_delivery_event FIELDS entity_id, request_id UNIQUE;
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-1', occurred_at: time::now() };
CREATE chat_delivery_event CONTENT { entity_id: 'thread:alpha', request_id: 'req-123', correlation_id: 'corr-2', occurred_at: time::now() };
SELECT * FROM chat_delivery_event WHERE entity_id='thread:alpha' AND request_id='req-123';
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-003', author_id: 'user:a', body: 'third', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-001', author_id: 'user:a', body: 'first', created_at: d'2026-02-15T03:30:00Z' };
CREATE chat_message CONTENT { thread_id: 'thread:order', message_id: 'msg-002', author_id: 'user:a', body: 'second', created_at: d'2026-02-15T03:30:00Z' };
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' ORDER BY created_at ASC, message_id ASC;
SELECT message_id, body, created_at FROM chat_message WHERE thread_id='thread:order' AND (created_at > d'2026-02-15T03:30:00Z' OR (created_at = d'2026-02-15T03:30:00Z' AND message_id > 'msg-001')) ORDER BY created_at ASC, message_id ASC;
LIVE SELECT * FROM chat_message WHERE thread_id = 'thread:live';
CREATE chat_message SET thread_id='thread:live', message_id='msg-live-1', author_id='user:live', body='live event', created_at=time::now();
LIVE SELECT DIFF FROM chat_message WHERE thread_id = 'thread:diff';
DEFINE TABLE user SCHEMAFULL;
DEFINE FIELD email ON TABLE user TYPE string;
DEFINE FIELD pass ON TABLE user TYPE string;
DEFINE ACCESS account ON DATABASE TYPE RECORD SIGNUP ( CREATE user SET email = $email, pass = $pass ) SIGNIN ( SELECT * FROM user WHERE email = $email AND pass = $pass );
DEFINE TABLE chat_private SCHEMAFULL PERMISSIONS FOR select WHERE owner = $auth.id, FOR create WHERE owner = $auth.id, FOR update WHERE owner = $auth.id, FOR delete WHERE owner = $auth.id;
DEFINE FIELD owner ON TABLE chat_private TYPE record<user>;
DEFINE FIELD body ON TABLE chat_private TYPE string;
LIVE SELECT * FROM chat_private;
