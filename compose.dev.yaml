name: gotong-royong-dev

services:
  surrealdb:
    image: surrealdb/surrealdb:v3.0.0
    command:
      [
        "start",
        "memory",
        "--log",
        "info",
        "--user",
        "${SURREAL_USER:-root}",
        "--pass",
        "${SURREAL_PASS:-root}",
        "--bind",
        "0.0.0.0:8000",
      ]
    ports:
      - "${SURREAL_PORT:-8000}:8000"
    healthcheck:
      test: ["CMD", "/surreal", "is-ready", "--endpoint", "ws://127.0.0.1:8000"]
      interval: 2s
      timeout: 2s
      retries: 30

  redis:
    image: redis:7-alpine
    command: ["redis-server", "--save", "", "--appendonly", "no"]
    ports:
      - "${REDIS_PORT:-6379}:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 2s
      timeout: 2s
      retries: 30

  # Optional local object storage for evidence uploads.
  # Enable with: `docker compose -f compose.dev.yaml --profile storage up -d`
  minio:
    profiles: ["storage"]
    image: minio/minio:RELEASE.2025-01-20T14-49-07Z
    command: ["server", "/data", "--console-address", ":9001"]
    environment:
      MINIO_ROOT_USER: "${MINIO_ROOT_USER:-minioadmin}"
      MINIO_ROOT_PASSWORD: "${MINIO_ROOT_PASSWORD:-minioadmin}"
    ports:
      - "${MINIO_PORT:-9000}:9000"
      - "${MINIO_CONSOLE_PORT:-9001}:9001"
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://127.0.0.1:9000/minio/health/ready"]
      interval: 2s
      timeout: 2s
      retries: 30
