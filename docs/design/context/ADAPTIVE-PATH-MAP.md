# Gotong Royong â€” Adaptive Path Map

> Visual reference for the adaptive path model. Replaces fixed track flowcharts (archived in `design/archive/TRACK-MAP.md`).

---

## Generic Adaptive Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADAPTIVE PATH PLAN                                             â”‚
â”‚  plan_id: plan_xx Â· version: 3 Â· track_hint: tuntaskan         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â•â• BRANCH: Utama (main) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ PHASE 1: Stabilisasiâ”‚ status: completed Â· source: ai        â”‚
â”‚  â”‚ objective: "..."     â”‚                                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚  â”‚ â˜‘ checkpoint c1     â”‚ completed Â· source: ai                â”‚
â”‚  â”‚ â˜‘ checkpoint c2     â”‚ completed Â· source: human (ğŸ”’ title)  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           â”‚                                                     â”‚
â”‚           â”‚         â”Œâ”€â”€ BRANCH: "Jika air naik" â”€â”€â”            â”‚
â”‚           â”‚         â”‚                              â”‚            â”‚
â”‚           â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚ PHASE: Evakuasi        â”‚  â”‚            â”‚
â”‚           â”‚         â”‚  â”‚ status: planned         â”‚  â”‚            â”‚
â”‚           â”‚         â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚            â”‚
â”‚           â”‚         â”‚  â”‚ â˜ Koordinasi BPBD      â”‚  â”‚            â”‚
â”‚           â”‚         â”‚  â”‚ â˜ Siapkan posko        â”‚  â”‚            â”‚
â”‚           â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚
â”‚           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚           â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ PHASE 2: Koordinasi â”‚ status: active Â· source: ai           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚  â”‚ â˜‘ Kumpulkan data    â”‚ completed                             â”‚
â”‚  â”‚ â–¶ Tetapkan PIC      â”‚ active (current)                      â”‚
â”‚  â”‚ â˜ Bagi tugas        â”‚ open                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ PHASE 3: Eksekusi   â”‚ status: planned Â· source: ai          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚  â”‚ â˜ Jalankan rencana  â”‚ planned                               â”‚
â”‚  â”‚ â˜ Laporkan progres  â”‚ planned                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ PHASE 4: Verifikasi â”‚ status: planned Â· source: ai          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚  â”‚ â˜ Periksa hasil     â”‚ planned                               â”‚
â”‚  â”‚ â˜ Konfirmasi dampak â”‚ planned                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Status Transitions

```
  Planned â”€â”€â–º Active â”€â”€â–º Completed
     â”‚           â”‚
     â”‚           â””â”€â”€â–º Blocked â”€â”€â–º Active (unblocked)
     â”‚
     â””â”€â”€â–º Skipped
```

Phases use: `Planned`, `Active`, `Completed`.
Checkpoints use: `Planned`, `Active`, `Open`, `Completed`, `Blocked`, `Skipped`.

---

## Source Tags & Locking

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Source Flow                              â”‚
  â”‚                                          â”‚
  â”‚  AI proposes â”€â”€â–º source: "ai"            â”‚
  â”‚       â”‚                                  â”‚
  â”‚       â–¼                                  â”‚
  â”‚  Human edits â”€â”€â–º source: "human"         â”‚
  â”‚       â”‚            + locked_fields: [title] â”‚
  â”‚       â”‚                                  â”‚
  â”‚       â–¼                                  â”‚
  â”‚  AI next pass â”€â”€â–º SKIPS locked fields    â”‚
  â”‚                   proposes via diff card  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Rule**: Once a human edits a field, it gets added to `locked_fields`. The LLM can never overwrite locked fields â€” it must propose changes as suggestions that appear as diff cards for human review.

---

## Branching

A branch is linked to a parent checkpoint. When conditions change, the LLM can propose a new branch:

```
  Main branch
  â”‚
  Phase 1 â”€â”€ checkpoint A â”€â”€ checkpoint B
  â”‚                              â”‚
  Phase 2 â”€â”€ ...                 â””â”€â”€ Branch: "Jika X terjadi"
                                      â”‚
                                      Phase X1 â”€â”€ checkpoint X1a
                                      Phase X2 â”€â”€ checkpoint X2a
```

- Main branch: `parent_checkpoint_id: null`
- Sub-branches: `parent_checkpoint_id: "checkpoint_B"`
- Branches are labeled for clarity (e.g., "Jika air naik lagi")

---

## Dual-Tab UI Rendering

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [scope â–¼]    Gotong Royong    [ğŸ”] [+]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Percakapan  â”‚  Tahapan                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•â•â•â•â•â•â•â•                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Phase 1: Stabilisasi âœ“                  â”‚
â”‚    â˜‘ Kumpulkan laporan lokasi            â”‚
â”‚    â˜‘ Tetapkan PIC lapangan               â”‚
â”‚                                          â”‚
â”‚  Phase 2: Koordinasi â–¶                   â”‚
â”‚    â˜‘ Kumpulkan data                      â”‚
â”‚    â–¶ Tetapkan PIC      [active]          â”‚
â”‚    â˜ Bagi tugas                          â”‚
â”‚                                          â”‚
â”‚  Phase 3: Eksekusi â—‹                     â”‚
â”‚    â˜ Jalankan rencana                    â”‚
â”‚    â˜ Laporkan progres                    â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€ Branch: "Jika air naik" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Phase: Evakuasi â—‹                  â”‚ â”‚
â”‚  â”‚    â˜ Koordinasi BPBD               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚  [ğŸ¤– AI mengusulkan perubahan]           â”‚
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ   ğŸ“‹  ğŸ¤  ğŸ””  ğŸ‘¤                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Adaptive Path vs Fixed Tracks

| Aspect | Fixed Tracks (Legacy) | Adaptive Path (Current) |
|---|---|---|
| **Path definition** | 5 predefined stage sequences | LLM-generated phases + checkpoints |
| **Track role** | Lifecycle driver | Optional `track_hint` metadata |
| **Stages** | Fixed per track (4-7 stages) | Dynamic phases (N, case-specific) |
| **Branching** | None | Supported via `parent_checkpoint_id` |
| **Editing** | Fixed transitions | Role-based editing with locked_fields |
| **AI role** | Classify into track | Propose & refine path, respect locks |
| **Concurrency** | N/A | Version-based with conflict detection |
| **Audit** | Basic | SHA-256 event hashing, retention tags |

---

## API Endpoints

| Method | Route | Action |
|---|---|---|
| POST | `/v1/adaptive-path/plans` | Create plan |
| GET | `/v1/adaptive-path/plans/:plan_id` | Get plan |
| GET | `/v1/adaptive-path/plans/by-entity/:entity_id` | Get by entity |
| POST | `/v1/adaptive-path/plans/:plan_id/update` | Update plan |
| GET | `/v1/adaptive-path/plans/:plan_id/events` | List audit events |
| POST | `/v1/adaptive-path/plans/:plan_id/suggestions` | Propose suggestion |
| GET | `/v1/adaptive-path/plans/:plan_id/suggestions` | List suggestions |
| POST | `.../suggestions/:suggestion_id/accept` | Accept suggestion |
| POST | `.../suggestions/:suggestion_id/reject` | Reject suggestion |

---

## DB Tables (SurrealDB)

| Table | Purpose |
|---|---|
| `path_plan` | Canonical plan with branches (JSON), versioned |
| `path_plan_event` | Append-only audit log |
| `plan_suggestion` | AI/human proposals with status |
| `path_branch` | Normalized branch projections |
| `path_phase` | Normalized phase projections |
| `path_checkpoint` | Normalized checkpoint projections |

---

*See `docs/design/specs/ADAPTIVE-PATH-SPEC-v0.1.md` for full specification.*
